#!/bin/bash
#===============================================================================
# Yane module for console management.
# Warning : this module doesn't work alone.
# You need some submodules like : yane_module_consoles_(xterm/tmux)
#===============================================================================


#-------------------------------------------------------------------------------
# Open a console in the shell
#   $1 : hostName
#-------------------------------------------------------------------------------
yaneOpenConsole () {
   echo "${SESSION_ID}_$1"
   c=$(eval yaneConsoleCmd_${hostMode[$1]} ${SESSION_ID}_$1)
   logMessage LOG "Running console '$c'"
   $c
}

#-------------------------------------------------------------------------------
# Open console on listed hosts
#-------------------------------------------------------------------------------
yaneOpenConsoleWindows () {
   logMessage LOG "Opening consoles"
   for idx in ${!console_mode[@]}
   do
       yaneOpenConsoleWindow_${console_mode[$idx]} $idx
   done
}

#-------------------------------------------------------------------------------
# Kill all open consoles in $SESSION_ID
#-------------------------------------------------------------------------------
yaneKillConsoles () {
   logMessage LOG "Kill consoles"

   if [ -f ./.yane_${SESSION_ID}_module_consoles.pid ] ; then
      for c in `cat ./.yane_${SESSION_ID}_module_consoles.pid`
      do
          $KILL $c
      done
      $RM ./.yane_${SESSION_ID}_module_consoles.pid

      for hostName in ${!console_mode[@]}
      do
        yaneKillConsoles_${console_mode[$hostName]} $hostName
      done
   fi
}
