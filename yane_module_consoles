#!/bin/bash
#===============================================================================
# Yane module for console management
#===============================================================================

#-------------------------------------------------------------------------------
# Open a console in the shell
#   $1 : hostName
#-------------------------------------------------------------------------------
yaneOpenConsole () {
   c=$(eval yaneConsoleCmd_${hostMode[$1]} $1)
   logMessage LOG "Running console '$c'" 
   $c
}

#-------------------------------------------------------------------------------
# Open a console in a window in $SESSION_ID
#   $1 : hostName
#   $2 : terminal (eg /usr/bin/xterm)
#
# WARNING : suits xterm only !!
#-------------------------------------------------------------------------------
yaneOpenConsoleWindow () {
   t=${2:-$XTERM}
   c=$(eval yaneConsoleCmd_${hostMode[$1]} ${SESSION_ID}_$1)

   logMessage LOG "Running console '$c' in terminal '$t'" 

   $t -title $1 -e $c &

   echo $! >> ./.yane_${SESSION_ID}_module_consoles.pid
}

#-------------------------------------------------------------------------------
# Open console on listed hosts
#-------------------------------------------------------------------------------
yaneOpenConsoleWindows () {
   logMessage LOG "Opening consoles"

   for hn in ${consHost[@]}
   do
      yaneOpenConsoleWindow $hn
   done
}

#-------------------------------------------------------------------------------
# Kill all open consoles in $SESSION_ID
#-------------------------------------------------------------------------------
yaneKillConsoles () {
   logMessage LOG "Kill consoles"
   
   if [ -f ./.yane_${SESSION_ID}_module_consoles.pid ] ; then 
      for c in `cat ./.yane_${SESSION_ID}_module_consoles.pid`
      do
          $KILL $c
      done
      $RM ./.yane_${SESSION_ID}_module_consoles.pid
   fi
}

